<!DOCTYPE html>
<html lang="en">

<head>
    <title>guilhebl IO Pages</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="guilhebl IO Pages - Software Development writings">
    <meta name="author" content="Guilherme Becker Lamounier">

    <!-- Bootstrap Core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css">

    <!-- Fonts -->
    <link href="/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='/font-awesome/css/font-lora.css' rel='stylesheet' type='text/css'>
    <link href='/font-awesome/css/font-montserrat.css' rel='stylesheet' type='text/css'>

    <!-- Custom Theme CSS -->
    <link href="/css/grayscale.css" rel="stylesheet">

    <!-- Syntax highlight CSS -->
    <link href="/css/syntax.css" rel="stylesheet" type="text/css">

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-49522383-1', 'guilhebl.github.io');
  ga('send', 'pageview');
</script>

</head>

<body id="page-top" data-spy="scroll" data-target=".navbar-custom">

    <nav class="navbar navbar-custom navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-main-collapse">
                    <i class="fa fa-bars"></i>
                </button>
                <a class="navbar-brand" href="/index.html">
                    <i class="fa fa-play-circle"></i>  <span class="light">guilhebl</span>
                </a>
            </div>

	<div class="col-sm-3 col-md-3 pull-right">
        <div class="input-group">

            <input type="text" class="search-field form-control" placeholder="Search" autocomplete="off">
            <div class="input-group-btn">
                <button class="btn btn-default" type="button"><i class="glyphicon glyphicon-search"></i></button>
            </div>
        </div>
        </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse navbar-right navbar-main-collapse">

                <ul class="nav navbar-nav">
                    <!-- Hidden li included to remove active class from about link when scrolled up past about section -->
                    <li class="hidden">
                        <a href="#page-top"></a>
                    </li>
                    <li class="page-scroll">
                        <a href="/#postList"><i class="fa fa-home fa-fw marginRight6"></i>Home</a>
                    </li>
                    <li class="page-scroll">
                        <a href="/categories"><i class="fa fa-list-ul fa-fw marginRight6"></i>Pages</a>
                    </li>
                    <li class="page-scroll">
                        <a href="/about"><i class="fa fa-user fa-fw marginRight6"></i>About</a>
                    </li>
                    <li class="page-scroll">
                        <a href="/contact"><i class="fa fa-coffee fa-fw marginRight6"></i>Contact</a>
                    </li>
                </ul>

            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->

        <div class="results resultsBox"></div>
    </nav>


    <section class="post">
        <div class="post-body">
            <div class="container">
		<div class="row-fluid">
		  <div class="center-block">
		     <section class="paper">
		      	<article class="head">user forgot password flow using RESTful webservices</article>
			<p class="muted">19 February 2015</p>

			<article contenteditable="false"><hr />




<h2>Forgot password flow using angularJS and Java</h2>




<p>People usually have a lot of different passwords for a lot of different websites and online services, forgetting a password is a very common thing and almost
every website that holds user account data has a forgot password mechanism flow to allow users to either generate a new password or type in a new password based on
their email or another personal piece of information. A typical example:</p>




<p>Login Page</p>




<p><img src="/assets/img/login-page-sample.png" alt="TEXT screenshot" /></p>




<p>Reset pasword page</p>




<p><img src="/assets/img/reset-password-sample.png" alt="TEXT screenshot" /></p>




<p>On this post I will demonstrate a sample forgot password flow, where a user will be able to generate a new password (this post is not intended to target a full complete scenario therefore it doesn't deal
with some other aspects like security and messaging). For sake of brevity I'm ommiting some implementation details but which one can potentially deduce or conclude based from evidence on the example.</p>




<hr />




<h2>Runtime Environment used on example</h2>




<p>the runtime environment used on the example is based on the following stack running on Ubuntu Linux 15.04 (vivid):</p>




<p>Frontend:</p>




<ul>
<li>AngularJS (1.3.12 or later)</li>
<li>NGINX (1.6.2 or later).</li>
</ul>




<p>---------------------------- JSON --------------------------------------------------------</p>




<p>Backend:</p>




<ul>
<li>javaEE EAR (javaEE 6 or later).</li>
<li>Glassfish (4.0 or later).</li>
</ul>




<p>---------------------------- SQL ---------------------------------------------------------</p>




<p>PostgreSQL: (9.4.0 or later)</p>




<p>OS: Linux Ubuntu (15.04)</p>




<hr />




<p>User model is based on this <a href="http://guilhebl.github.io/database/2014/06/18/user-domain-model-relational/">domain model</a>.</p>




<p>Other <a href="http://guilhebl.github.io/java/2014/04/09/domain-model-generic-superclass/">good practices</a>.</p>




<hr />




<hr />




<hr />




<h2>Presentation</h2>




<p>on the html a form or div will accomodate user credentials for reseting the password basically containing the user email like in the Reset password FORM example:</p>




<p>HTML:</p>




<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div&gt;</span>
              <span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">"resetPasswordForm"</span> <span class="na">novalidate=</span><span class="s">"novalidate"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">ng-controller=</span><span class="s">"ResetPasswordCtrl"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;div&gt;</span>
                        <span class="nt">&lt;h3&gt;</span>forgot Your Password?<span class="nt">&lt;/h3&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                    <span class="nt">&lt;div&gt;</span>
                        Please insert your email:
                    <span class="nt">&lt;/div&gt;</span>                    
                    <span class="nt">&lt;di&gt;</span>
                        <span class="nt">&lt;label&gt;</span>email<span class="nt">&lt;/label&gt;</span>
                        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"email"</span> <span class="na">name=</span><span class="s">"email"</span> <span class="na">ng-model=</span><span class="s">"resetPasswordEmail"</span> <span class="nt">/&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                    <span class="nt">&lt;div&gt;</span>
                        <span class="nt">&lt;button</span> <span class="na">ng-click=</span><span class="s">"resetPassword()"</span><span class="nt">&gt;</span>Reset<span class="nt">&lt;/button&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                    <span class="nt">&lt;div&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#/login"</span><span class="nt">&gt;</span>back<span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>                    
                <span class="nt">&lt;/div&gt;</span>
              <span class="nt">&lt;/form&gt;</span>
            <span class="nt">&lt;/div&gt;</span></code></pre></div>




<p>once user types the email and clicks on Reset button, an Angular controller will handle the ng-click event sending an AJAX request to the server-side.</p>




<hr />




<h4>Frontend</h4>




<p>Angular JS service:</p>




<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">services</span><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">'UserService'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'$resource'</span><span class="p">,</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">$resource</span><span class="p">){</span>    
        <span class="k">return</span> <span class="nx">$resource</span><span class="p">(</span><span class="s1">'/myapp/rest/user/:id'</span><span class="p">,</span> 
                <span class="p">{</span>
                    <span class="na">id</span><span class="p">:</span> <span class="s2">"@id"</span>
                <span class="p">},</span>
                <span class="p">{</span>                    
                    <span class="s1">'resetPassword'</span><span class="p">:</span> <span class="p">{</span><span class="nl">method</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span> <span class="na">params</span><span class="p">:</span> <span class="p">{</span><span class="na">email</span><span class="p">:</span> <span class="s1">'@email'</span><span class="p">},</span> <span class="na">url</span><span class="p">:</span> <span class="s1">'/myapp/rest/user/reset-password/:email'</span><span class="p">}</span>
                <span class="p">}</span>
        <span class="p">);</span>
      <span class="p">}]);</span></code></pre></div>




<p>Angular JS controller:</p>




<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">controllers</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">'ResetPasswordCtrl'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'$scope'</span><span class="p">,</span> <span class="s1">'$location'</span><span class="p">,</span> <span class="s1">'UserService'</span><span class="p">,</span>
      <span class="kd">function</span> <span class="nx">ResetPasswordCtrl</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">$location</span><span class="p">,</span> <span class="nx">UserService</span><span class="p">)</span> <span class="p">{</span>
        
        <span class="c1">// action handler for ng-click on form</span>
            <span class="nx">$scope</span><span class="p">.</span><span class="nx">resetPassword</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">UserService</span><span class="p">.</span><span class="nx">resetPassword</span><span class="p">({</span><span class="na">email</span><span class="p">:</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">resetPasswordEmail</span><span class="p">},</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">successHandlerResetPassword</span><span class="p">,</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">errorHandler</span><span class="p">);</span>
            <span class="p">};</span>

            <span class="nx">$scope</span><span class="p">.</span><span class="nx">errorHandler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
                  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
                  <span class="nx">$location</span><span class="p">.</span><span class="nx">path</span><span class="p">(</span><span class="s1">'/error'</span><span class="p">);</span>
            <span class="p">};</span>

        <span class="nx">$scope</span><span class="p">.</span><span class="nx">successHandlerResetPassword</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">httpResponse</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'SUCCESS!'</span><span class="p">);</span>
              <span class="nx">$location</span><span class="p">.</span><span class="nx">path</span><span class="p">(</span><span class="s1">'/home'</span><span class="p">);</span>             
        <span class="p">};</span>
               
    <span class="p">}]);</span></code></pre></div>




<hr />




<h4>Backend</h4>




<p>In the server-side a JAX-RS endpoint will be receiving the RESTful request and calling an EJB to process the business operation on behalf of the user.</p>




<p>To learn more about JAX-RS please check this <a href="http://guilhebl.github.io/java/2014/03/27/build-jaxrs-rest/">post</a>.</p>




<p>JAX-RS RESTful endpoint implementation:</p>




<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">io</span><span class="o">.</span><span class="na">github</span><span class="o">.</span><span class="na">guilhebl</span><span class="o">.</span><span class="na">sample</span><span class="o">.</span><span class="na">webservice</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.ejb.EJB</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.enterprise.context.RequestScoped</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.inject.Named</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.Consumes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.GET</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.Path</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.PathParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.Produces</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.core.MediaType</span><span class="o">;</span>

<span class="nd">@Named</span> 
<span class="nd">@RequestScoped</span>
<span class="nd">@Path</span><span class="o">(</span><span class="s">"/user"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserService</span> <span class="o">{</span>
        
    <span class="nd">@EJB</span><span class="o">(</span><span class="n">mappedName</span><span class="o">=</span><span class="s">"java:global/myapp/myappEJB/UserServiceRest"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">UserServiceRestRemote</span> <span class="n">userServiceRestRemote</span><span class="o">;</span>
        
    <span class="kd">public</span> <span class="n">UserService</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nd">@GET</span>
    <span class="nd">@Consumes</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
    <span class="nd">@Produces</span><span class="o">({</span><span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_XML</span><span class="o">,</span> <span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">})</span>
    <span class="nd">@Path</span><span class="o">(</span><span class="s">"/reset-password/{email}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">resetPassword</span><span class="o">(</span><span class="nd">@PathParam</span><span class="o">(</span><span class="s">"email"</span><span class="o">)</span> <span class="n">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>     
            <span class="n">userServiceRestRemote</span><span class="o">.</span><span class="na">resetUserPassword</span><span class="o">(</span><span class="n">email</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">EncryptUtil</span><span class="o">.</span><span class="na">generateJSONStringResponse</span><span class="o">(</span><span class="n">NameConstants</span><span class="o">.</span><span class="na">SUCCESS</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">response</span><span class="o">.</span><span class="na">sendError</span><span class="o">(</span><span class="n">HttpServletResponse</span><span class="o">.</span><span class="na">SC_INTERNAL_SERVER_ERROR</span><span class="o">);</span> 
            <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">IOException</span> <span class="n">ioe</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">ioe</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>            
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre></div>




<p>In order to update the business entities update the DB, an EJB handles the business transaction calling a JPA provider to map the operation
to SQL and commit the transaction if no errors are found.</p>




<p>EJB remote interface:</p>




<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">io</span><span class="o">.</span><span class="na">github</span><span class="o">.</span><span class="na">guilhebl</span><span class="o">.</span><span class="na">sample</span><span class="o">.</span><span class="na">ejb</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.ejb.Remote</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">io.github.guilhebl.sample.domain.User</span><span class="o">;</span>

<span class="nd">@Remote</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserServiceRestRemote</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">User</span> <span class="n">findById</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">);</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">resetUserPassword</span><span class="o">(</span><span class="n">String</span> <span class="n">email</span><span class="o">);</span>
<span class="o">}</span></code></pre></div>




<p>EJB implementation:</p>




<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">io</span><span class="o">.</span><span class="na">github</span><span class="o">.</span><span class="na">guilhebl</span><span class="o">.</span><span class="na">sample</span><span class="o">.</span><span class="na">ejb</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.StringWriter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Writer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.ejb.EJB</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ejb.Stateless</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ejb.TransactionAttribute</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ejb.TransactionAttributeType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.TypedQuery</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.criteria.CriteriaBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.criteria.CriteriaQuery</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.criteria.Join</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.criteria.Path</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.criteria.Predicate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.criteria.Root</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.metamodel.EntityType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.metamodel.Metamodel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.metamodel.SingularAttribute</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">io.github.guilhebl.sample.ejb.util.EncryptUtil</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.github.guilhebl.sample.domain.User</span><span class="o">;</span>

<span class="cm">/**
 * Session Bean implementation class UserServiceRest
 */</span>
<span class="nd">@Stateless</span><span class="o">(</span><span class="n">mappedName</span><span class="o">=</span><span class="s">"java:global/myapp/myappEJB/UserServiceRest"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserServiceRest</span> <span class="kd">implements</span> <span class="n">UserServiceRestRemote</span> <span class="o">{</span>

    <span class="nd">@PersistenceContext</span>
    <span class="kd">protected</span> <span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">;</span>

        <span class="kd">public</span> <span class="n">UserServiceRest</span><span class="o">()</span> <span class="o">{}</span>

    <span class="kd">public</span> <span class="n">User</span> <span class="n">findById</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span>   <span class="kd">throws</span> <span class="n">ServiceException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@TransactionAttribute</span><span class="o">(</span><span class="n">TransactionAttributeType</span><span class="o">.</span><span class="na">REQUIRED</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">resetUserPassword</span><span class="o">(</span><span class="n">String</span> <span class="n">email</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServiceException</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">findById</span><span class="o">(</span><span class="n">email</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">user</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ServiceException</span><span class="o">(</span><span class="s">"Error: user not found for email: "</span> <span class="o">+</span> <span class="n">email</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getActive</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="o">!</span><span class="n">user</span><span class="o">.</span><span class="na">getActive</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">Boolean</span><span class="o">.</span><span class="na">TRUE</span><span class="o">.</span><span class="na">toString</span><span class="o">()))</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ServiceException</span><span class="o">(</span><span class="s">"Error: user not active for email: "</span> <span class="o">+</span> <span class="n">email</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">String</span> <span class="n">passwordNew</span> <span class="o">=</span> <span class="n">EncryptUtil</span><span class="o">.</span><span class="na">generateRandomPassword</span><span class="o">(</span><span class="n">Apponstants</span><span class="o">.</span><span class="na">USER_GENERATE_PASSWORD_LENGTH</span><span class="o">);</span> <span class="c1">// generates an 8 length password by default</span>
            <span class="n">user</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="n">EncryptUtil</span><span class="o">.</span><span class="na">getMD5String</span><span class="o">(</span><span class="n">passwordNew</span><span class="o">));</span> <span class="c1">// encrypt using MD5</span>
            <span class="n">entityManager</span><span class="o">.</span><span class="na">merge</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">se</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">se</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">ServiceException</span><span class="o">(</span><span class="s">"Error on reseting password for email: "</span> <span class="o">+</span> <span class="n">email</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre></div>




<p>EncryptUtils class uses java UUID as a Random ID generator:</p>




<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">io</span><span class="o">.</span><span class="na">github</span><span class="o">.</span><span class="na">guilhebl</span><span class="o">.</span><span class="na">ejb</span><span class="o">.</span><span class="na">util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.security.MessageDigest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.UUID</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EncryptUtil</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="cm">/**
     * 
     */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">generateUniqueID</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">UUID</span> <span class="n">idOne</span> <span class="o">=</span> <span class="n">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">idOne</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">getMD5String</span><span class="o">(</span><span class="n">String</span> <span class="n">target</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">MessageDigest</span> <span class="n">md</span> <span class="o">=</span> <span class="n">MessageDigest</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">"MD5"</span><span class="o">);</span>
            <span class="n">md</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">target</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
            <span class="kt">byte</span> <span class="n">byteData</span><span class="o">[]</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="na">digest</span><span class="o">();</span>

            <span class="c1">// convert the byte to hex format method 1</span>
            <span class="n">StringBuffer</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">();</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">byteData</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">((</span><span class="n">byteData</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="o">)</span> <span class="o">+</span> <span class="mh">0x100</span><span class="o">,</span> <span class="mi">16</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>

        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>  

    <span class="cm">/**
     * 
     * Generates simple JSON String responses in the format:
     * 
     * {"result":"string"}
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">generateJSONStringResponse</span><span class="o">(</span><span class="n">String</span> <span class="n">str</span><span class="o">)</span> <span class="o">{</span>      
        <span class="k">return</span> <span class="s">"{\"result\":"</span> <span class="o">+</span> <span class="s">"\""</span> <span class="o">+</span> <span class="n">str</span> <span class="o">+</span> <span class="s">"\"}"</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre></div>




<hr />




<hr />




<p>Done, now whenever user types the email on the forgot password form and clicks on Reset button,
the results of the AJAX request to the server-side can be seen using a browser tool (usually the f12 key on the network tab) like:</p>




<div class="highlight"><pre><code class="language-http" data-lang="http"><span class="err">Request URL:https://localhost/myapp/rest/user/reset-password/mytestaddress@gmail.com
Request Method:GET
Status Code:200 OK
Request Headersview source
Accept:application/json, text/plain, */*
Accept-Encoding:gzip, deflate, sdch
Accept-Language:en-US,en;q=0.8,pt;q=0.6
Connection:keep-alive
Cookie:JSESSIONID=67bb7a56fa98cf92ceb15a8105aa
Host:localhost
Referer:https://localhost/app/index.html
User-Agent:Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/40.0.2214.94 Safari/537.36
Response Headersview source
Connection:keep-alive
Content-Length:7
Content-Type:application/json
Date:Fri, 20 Feb 2015 10:16:19 GMT
Server:nginx/1.6.2 (Ubuntu)
X-Powered-By:Servlet/3.1 JSP/2.3 (GlassFish Server Open Source Edition  4.1  Java/Oracle Corporation/1.8)

{"response": "success"}</span></code></pre></div>




<hr />




<p>Now it is convenient to check in the DB the results of the opration, if user password has changed accordingly. I will not cover the DB configuration part of it, since any JPA compatible JDBC driver can connect to a specific DB server instance.</p>




<p>In overall this sample depicts a typical implementation of both Frontend and Backend of a user re-generate password scenario, using Angular and JAX-RS.</p>




<hr />

</article>
		      </section>

		    <div id="disqus_thread"></div>
		    <script type="text/javascript">
			/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
			var disqus_shortname = 'guilhebliopages'; // required: replace example with your forum shortname

			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function() {
			    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
			    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
			    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		    </script>
		    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
		    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>		    
		  </div>

		</div>
            </div>
        </div>
    </section>
    <!-- Core JavaScript Files -->
    <script src="/js/jquery-1.10.2.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/jquery.easing.min.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="/js/grayscale.js"></script>

    <!-- Plugin Third party JavaScript -->
    <script src="/js/jekyll-search.js"></script>
    <script src="/js/jekyll-search.jquery.js"></script>
 
</body>

</html>


